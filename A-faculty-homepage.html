<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Faculty Dashboard</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>

  <!-- Site styles (reuse existing) -->
  <link rel="stylesheet" href="css/style.css">

  <style>
    /* small page-specific adjustments */
    .student-photo { max-height: 60px; width: auto; border-radius:6px; }
    .status-normal { color: #1e7e34; font-weight:600; }
    .status-alert { color: #d63384; font-weight:600; }
  </style>
</head>
<body>

  <!-- Banner -->
  <nav class="navbar navbar-expand-lg navbar-dark py-2 px-4 d-none d-md-block" style="background-color: #8c0001; max-height:113px;">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="img/lpu_banner.png" alt="LPU" style="max-height:90px;">
      </a>
    </div>
  </nav>

  <nav class="navbar navbar-expand-lg navbar-dark py-2 px-4 d-block d-md-none" style="background-color: #8c0001; max-height:113px;">
    <div class="container-fluid d-flex justify-content-center">
      <a class="navbar-brand" href="#">
        <img src="img/lpu_banner.png" alt="LPU" style="max-height:93px;">
      </a>
    </div>
  </nav>

  <!-- Menu -->
  <nav class="navbar navbar-expand-lg navbar-dark py-2 px-4" style="background-color:#dde0e4;">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#facNav" aria-controls="facNav" aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="facNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link active text-dark" href="#" id="studentsNav">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="#" id="scansNav"></a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="#" id="reportsNav">Insights</a></li>
        </ul>
        <div>
          <button id="logoutBtn" class="btn btn-outline-danger rounded-pill px-4 py-2" style="color:#8c0001;">
            <i class="fas fa-sign-out-alt"></i> <span class="d-none d-md-inline">Log-out</span>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mt-5">
    <div class="card mb-4 shadow">
      <div class="card-header text-white" style="background-color:#8c0001">
        <h3 class="mb-0">Faculty Dashboard</h3>
      </div>
      <div class="card-body">
        <div class="row g-3 align-items-center">
          <div class="col-md-8">
            <h5 class="mb-0">Welcome, <span id="profName">Prof. Maria Santos</span></h5>
            <small class="text-muted">View students and their latest scan results</small>
          </div>

         
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row g-2">
          <div class="col-md-4">
            <input id="searchInput" type="search" class="form-control" placeholder="Search by name or ID">
          </div>
          <div class="col-md-3">
            <select id="filterStatus" class="form-select">
              <option value="all">All statuses</option>
              <option value="normal">Normal</option>
              <option value="alert">Alert</option>
            </select>
          </div>
          <div class="col-md-5 text-end">
            <small class="text-muted me-2">Total students: <span id="totalCount">0</span></small>
            <button id="refreshBtn" class="btn btn-sm btn-outline-secondary"><i class="fas fa-sync"></i> Refresh</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Students Table -->
    <div class="card mb-4">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th></th>
                <th>ID</th>
                <th>Name</th>
                <th>Course/Year</th>
                <th>Latest Result</th>
                <th>Last Scan</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody id="studentsTableBody">
              <!-- populated by JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Student Details Modal -->
  <div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Student Scans</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex gap-3 mb-3 align-items-center">
            <img id="modalPhoto" src="img/def.jpg" class="student-photo shadow-sm" alt="photo">
            <div>
              <h6 id="modalName" class="mb-0">Student Name</h6>
              <small id="modalId" class="text-muted">ID</small><br>
              <small id="modalCourse" class="text-muted">Course</small>
            </div>
          </div>

          <h6>Scan History</h6>
          <div class="table-responsive">
            <table class="table table-sm">
              <thead><tr><th>Date</th><th>Time</th><th>Result</th><th>Notes</th></tr></thead>
              <tbody id="modalHistoryBody"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button id="closeModal" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button id="notifyBtn" type="button" class="btn btn-danger">Flag / Notify</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <script>
    // sample data - replace with server data as needed
    const students = [
      { id: '202312001', name: 'Kirk Tablate', course: 'BSCPE 4th', latestResult: 'Normal', lastScan: '2025-11-28 07:10', photo:'img/def.jpg',
        history: [{date:'2025-11-28', time:'07:10', result:'Normal', notes:'OK'}]
      },
      { id: '202312002', name: 'Jude Eraldo', course: 'BSCPE 4th', latestResult: 'Alert', lastScan: '2025-11-29 08:25', photo:'img/def.jpg',
        history: [{date:'2025-11-29', time:'08:25', result:'Sleep-Deprived', notes:'Advise rest'}]
      },
      { id: '202312003', name: 'Kian Dela Cruz', course: 'BSCPE 4th', latestResult: 'Normal', lastScan: '2025-11-27 06:55', photo:'img/def.jpg',
        history: [{date:'2025-11-27', time:'06:55', result:'Normal', notes:''}]
      }
    ];

    const tableBody = document.getElementById('studentsTableBody');
    const totalCountEl = document.getElementById('totalCount');
    const searchInput = document.getElementById('searchInput');
    const filterStatus = document.getElementById('filterStatus');

    function renderTable(list) {
      tableBody.innerHTML = '';
      list.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><img src="${s.photo}" class="student-photo"></td>
          <td>${s.id}</td>
          <td>${s.name}</td>
          <td>${s.course}</td>
          <td>${s.latestResult === 'Normal' ? '<span class="status-normal">Normal</span>' : '<span class="status-alert">Alert</span>'}</td>
          <td>${s.lastScan}</td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline-primary me-2 view-btn" data-id="${s.id}"><i class="fas fa-eye"></i> View</button>
          </td>`;
        tableBody.appendChild(tr);
      });
      totalCountEl.textContent = list.length;
      attachViewHandlers();
    }

    function attachViewHandlers() {
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          openStudentModal(id);
        });
      });
    }

    function openStudentModal(id) {
      const s = students.find(x => x.id === id);
      if (!s) return;
      document.getElementById('modalPhoto').src = s.photo;
      document.getElementById('modalName').textContent = s.name;
      document.getElementById('modalId').textContent = s.id;
      document.getElementById('modalCourse').textContent = s.course;
      const body = document.getElementById('modalHistoryBody');
      body.innerHTML = '';
      s.history.forEach(h => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${h.date}</td><td>${h.time}</td><td>${h.result}</td><td>${h.notes}</td>`;
        body.appendChild(tr);
      });
      const modal = new bootstrap.Modal(document.getElementById('studentModal'));
      modal.show();
    }

    function filterAndSearch() {
      const q = searchInput.value.trim().toLowerCase();
      const status = filterStatus.value;
      let res = students.filter(s => {
        const matchesQ = s.name.toLowerCase().includes(q) || s.id.toLowerCase().includes(q) || s.course.toLowerCase().includes(q);
        const matchesStatus = status === 'all' ? true : (status === 'normal' ? s.latestResult === 'Normal' : s.latestResult !== 'Normal');
        return matchesQ && matchesStatus;
      });
      renderTable(res);
    }

    // initial render
    renderTable(students);

    searchInput.addEventListener('input', filterAndSearch);
    filterStatus.addEventListener('change', filterAndSearch);
    document.getElementById('refreshBtn').addEventListener('click', () => renderTable(students));
    document.getElementById('exportCsv').addEventListener('click', () => {
      // minimal CSV export
      const rows = [['ID','Name','Course','Latest Result','Last Scan'], ...students.map(s=>[s.id,s.name,s.course,s.latestResult,s.lastScan])];
      const csv = rows.map(r => r.map(c=>`"${(c||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'students_scans.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // logout basic handler
    document.getElementById('logoutBtn').addEventListener('click', () => { window.location.href = 'index.html'; });

    // optional notify button action
    document.getElementById('notifyBtn').addEventListener('click', () => {
      alert('Flag/Notify action executed (placeholder).');
      const modal = bootstrap.Modal.getInstance(document.getElementById('studentModal'));
      modal.hide();
    });
  </script>
</body>
</html>
